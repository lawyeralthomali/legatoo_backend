name: Deploy Backend via SSH/RSYNC
#test
on:
  push:
    branches: [ main ] # ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø±ÙØ¹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Backend Code
        uses: actions/checkout@v4
        # Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ ÙÙ‚Ø·

      # --- Ø§Ù„Ù†Ø´Ø± Ø¹Ø¨Ø± SSH ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª ---
      - name: Deploy Backend and Restart Services
        uses: appleboy/ssh-action@v0.1.7 # Ø£Ø¯Ø§Ø© Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¢Ù…Ù†Ø© Ø¹Ø¨Ø± SSH
        with:
          host: 72.60.197.118 # ğŸ›‘ IP Ø®Ø§Ø¯Ù…Ùƒ (VPS)
          username: root       # Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙØª Ù„Ù‡ Ù…ÙØªØ§Ø­ SSH
          key: ${{ secrets.SSH_PRIVATE_KEY }} # Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø§Ù„Ù…Ø®Ø²Ù† ÙÙŠ GitHub
          script: |
            # 1. Navigate to the backend directory
            cd /root/legatoo_backend
            
            # 2. Pull latest code from git
            git pull origin main
            
            # 3. Make deployment script executable and run it
            chmod +x deploy_files/deploy_simple.sh
            ./deploy_files/deploy_simple.sh
            
            # 4. Verify deployment
            echo "Deployment completed. Checking status..."
            sleep 5
            curl -s http://localhost:8000/health || echo "Health check failed"